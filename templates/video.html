{% extends "layout.html" %}
{% block content %}

<div class="video-player-container">
    <div class="video-header">
        <h2 class="video-title-large">{{ video.title }}</h2>
        <div class="video-actions">
            <span class="btn-secondary" style="background: rgba(0,0,0,0.5); border-color: transparent;"><i class="fas fa-eye"></i> المشاهدات: {{ video.views }}</span>
            <a href="{{ url_for('download_video', video_id=video.id) }}" class="btn-primary"><i class="fas fa-download"></i> تحميل: {{ video.downloads }}</a>
            {% if is_admin %}
            <button type="button" class="btn-secondary" onclick="openPlaylistModal('{{ video.id }}')" style="color: var(--primary-color)"><i class="fas fa-bookmark"></i> حفظ في قائمة</button>
            <a href="{{ url_for('edit_video', video_id=video.id) }}" class="btn-secondary"><i class="fas fa-edit"></i> تعديل</a>
            <form action="{{ url_for('delete_video', video_id=video.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('هل أنت متأكد من رغبتك في حذف هذا الفيديو نهائياً؟');">
                <button type="submit" class="btn-danger" style="background-color: var(--error-color); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 500; cursor: pointer; transition: all 0.3s ease;"><i class="fas fa-trash"></i> حذف الفيديو</button>
            </form>
            {% endif %}
        </div>
    </div>
    
    <div class="player-wrapper">
        <video controls autoplay class="main-video-player">
            <source src="{{ url_for('uploaded_file', filename=video.filename) }}" type="video/{{ video.filename.split('.')[-1] }}">
            متصفحك لا يدعم مشغل الفيديو.
        </video>
    </div>
    
    <div class="video-details">
        {% if video.description %}
        <div class="video-description">
            <h4><i class="fas fa-info-circle"></i> وصف الفيديو:</h4>
            <p>{{ video.description }}</p>
        </div>
        {% endif %}
        <div class="meta-info">
            <span class="date" style="margin-left: 20px;"><i class="far fa-calendar-alt"></i> تاريخ الرفع: {{ video.upload_date.strftime('%Y-%m-%d %H:%M') }}</span>
        </div>
        
        {% if video.tags %}
        <div class="video-tags-container">
            <h4 class="tags-title"><i class="fas fa-tags"></i> الكلمات المفتاحية:</h4>
            <div class="tags-list">
                {% for tag in video.tags.split(',') %}
                    <a href="{{ url_for('index', q=tag.strip()) }}" class="tag-link">{{ tag.strip() }}</a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="back-link">
        <a href="{{ url_for('index') }}" class="btn-secondary"><i class="fas fa-arrow-right"></i> العودة للرئيسية</a>
    </div>
</div>
<!-- Playlist Selection Modal -->
<div id="playlistModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center;">
    <div class="modal-content" style="background: var(--dark-bg); padding: 30px; border-radius: 15px; border: 1px solid var(--glass-border); width: 90%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
        <h3 style="margin-bottom: 20px;"><i class="fas fa-list-ul"></i> حفظ الفيديو في قائمة</h3>
        <form action="{{ url_for('add_to_playlist') }}" method="POST">
            <input type="hidden" name="video_id" id="modal_video_id" value="">
            <div class="form-group">
                <label for="playlist_id">اختر القائمة:</label>
                <select name="playlist_id" id="playlist_id" class="form-control" required style="background: var(--card-bg);">
                    <option value="" disabled selected>-- اختر قائمة --</option>
                    {% for playlist in playlists %}
                    <option value="{{ playlist.id }}">{{ playlist.name }}</option>
                    {% endfor %}
                </select>
                {% if not playlists %}
                <p style="color: var(--error-color); font-size: 0.85rem; margin-top: 10px;">لا تملك أي قوائم حالياً. <a href="{{ url_for('manage_playlists') }}" style="color: var(--primary-color); text-decoration: underline;">أنشئ قائمة جديدة</a></p>
                {% endif %}
            </div>
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button type="submit" class="btn-primary" style="flex: 1;"><i class="fas fa-save"></i> حفظ</button>
                <button type="button" class="btn-secondary" style="flex: 1;" onclick="closePlaylistModal()">إلغاء</button>
            </div>
        </form>
    </div>
</div>

<script>
function openPlaylistModal(videoId) {
    document.getElementById('modal_video_id').value = videoId;
    let modal = document.getElementById('playlistModal');
    modal.style.display = 'flex';
}

function closePlaylistModal() {
    document.getElementById('playlistModal').style.display = 'none';
}

window.onclick = function(event) {
    let modal = document.getElementById('playlistModal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
</script>

{% endblock %}
